<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Trans-Eurasian Hyperexpress</title>

    <!-- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- Latest compiled and minified JavaScript -->
    <script src="js/jquery-2.1.4.min.js"></script>
    <script src="js/bootstrap.min.js"></script>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <script type="text/javascript">
        var freq = parseFloat("12.345");
        var width = 7;
        var height = width * 1.618;
        var hoffset = 3;
        var woffset = 3;
        var gap = 15;
        
        var messages = ["REDIRECT TRAIN", "ROBOT OVERLORD", "JOURNAL MEMORY", "TEMPORAL SHIFT"];
        
        var lettermap = {
          "A": [3,6,9,11,13,15,16,18],
"B": [0,5,6,7,11,16,19,20,23],
"C": [1,4,13,15,24,26],
"D": [0,5,6,7,16,18,21,23],
"E": [0,1,4,5,6,7,9,11],
"F": [0,1,6,7,9,11],
"G": [1,3,4,9,13,15,24,26],
"H": [2,3,6,7,9,11],
"I": [0,1,4,5,8,10],
"J": [0,1,5,6,8,10],
"K": [6,7,11,17,19,20,22],
"L": [4,5,6,7],
"M": [2,3,6,7,12,14,17,19],
"N": [2,3,6,7,12,14,20,22],
"O": [13,15,16,18,21,23,24,26],
"P": [0,6,7,11,16,19],
"Q": [13,15,16,18,20,21,22,23,24,26],
"R": [0,6,7,11,16,19,20,22],
"S": [13,14,16,20,23,26],
"T": [0,1,8,10],
"U": [2,3,4,5,6,7],
"V": [2,7,21,23,24,26],
"W": [2,3,6,7,20,22,25,27],
"X": [12,14,17,19,20,22,25,27],
"Y": [10,12,14,17,19],
"Z": [0,1,4,5,17,19,25,27],
" ": []
        }
        
        var segmentmap = [
            [0,0,2,0], // 0
            [2,0,4,0], // 1
            [4,0,4,2], // 2
            [4,2,4,4], // 3
            [4,4,2,4], // 4
            [2,4,0,4], // 5
            [0,4,0,2], // 6
            [0,2,0,0], // 7
            
            [2,0,2,2], // 8
            [4,2,2,2], // 9
            [2,4,2,2], // 10
            [0,2,2,2], // 11
            
            [0,0,1,1], // 12
            [2,0,1,1], // 13
            [2,2,1,1], // 14
            [0,2,1,1], // 15
            
            [2,0,3,1], // 16
            [4,0,3,1], // 17
            [4,2,3,1], // 18
            [2,2,3,1], // 19
            
            [2,2,3,3], // 20
            [4,2,3,3], // 21
            [4,4,3,3], // 22
            [2,4,3,3], // 23
            
            [0,2,1,3], // 24
            [2,2,1,3], // 25
            [2,4,1,3], // 26
            [0,4,1,3] // 27
        ]
        
        function updateLock() {
            if (localStorage.getItem("sensors/unlocked")) {
                $('.lock').hide();
            }
        }
        
        function select() {
            $('.antenna').removeClass("selected")
            $(this).addClass("selected");
            print();
        }
        
        function print() {
            var message = wordToSegmentsList("NO SIGNAL");
            if ($("#frequency").val() == "12.345") {
                if ($("#antenna1").hasClass("selected")) {
                    message = segmentsListPlusWord(segmentsListPlusWord(wordPlus(messages[0], messages[1]), messages[2]), messages[3]);
                } else if ($("#antenna2").hasClass("selected")) {
                    message = segmentsListPlusWord(wordPlus(messages[1], messages[2]), messages[3]);
                } else if ($("#antenna3").hasClass("selected")) {
                    message = wordPlus(messages[2], messages[3]);
                }
                
            }
            var canvas = $('#signal')[0]
            var ctx = canvas.getContext('2d');
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawWordBySegments(ctx, message);
        }
        
        function drawSegment(ctx, segmentId, offset) {
            var segment = segmentmap[segmentId];
            ctx.beginPath();
            ctx.moveTo(segment[0] * width + offset, segment[1] * height + hoffset);
            ctx.lineTo(segment[2] * width + offset, segment[3] * height + hoffset);
            ctx.stroke();
        }
        
        function drawLetter(ctx, letter, offset) {
            var segments = lettermap[letter];
            drawSegments(ctx, segments, offset);
        }
        
        function drawSegments(ctx, segments, offset) {
            for (var i = 0; i < segments.length; ++i) {
                drawSegment(ctx, segments[i], offset);
            }
        }
        
        function drawWordBySegments(ctx, segmentsList) {
            for (var i = 0; i < segmentsList.length; ++i) {
                drawSegments(ctx, segmentsList[i], (4*width+gap)*i + woffset);
            }
        }
        
        function drawWord(ctx, word) {
            for (var i = 0; i < word.length; ++i) {
                drawLetter(ctx, word[i], (4*width+gap)*i + woffset);
            }
        }
        
        function wordToSegmentsList(word) {
            var result = [];
            for (var i = 0; i < word.length; ++i) {
                result.push(lettermap[word[i]]);
            }
            return result;
        }
        
        function plus(segmentsA, segmentsB) {
            return $(segmentsA).not(segmentsB).get().concat($(segmentsB).not(segmentsA).get());
        }
        
        function wordPlus(wordA, wordB) {
            var result = [];
            for (var i = 0; i < wordA.length; ++i) {
                var segmentsA = lettermap[wordA[i]];
                var segmentsB = lettermap[wordB[i]];
                result.push(plus(segmentsA, segmentsB));
            }
            return result;
        }
        
        function segmentsListPlusWord(segmentsList, word) {
            var result = [];
            for (var i = 0; i < word.length; ++i) {
                var segmentsA = segmentsList[i];
                var segmentsB = lettermap[word[i]];
                result.push(plus(segmentsA, segmentsB));
            }
            return result;
        }
        
        function code(e) {
            var m = $('#code').val().toUpperCase();
            if (m == messages[0]) {
                $('#video').attr("src", "https://www.youtube.com/embed/6M-ZdC1C6sU");
                $('#video').removeClass("hidden");
                localStorage.setItem("sensors/unlocked", true);
                localStorage.setItem("sensors/A", true);
                updateLock();
                if (e != null ) { answers(); }
            } else if (m == messages[1]) {
                $('#video').attr("src", "https://www.youtube.com/embed/7Pn2Ayzafr4");
                $('#video').removeClass("hidden");
                localStorage.setItem("sensors/B", true);
                if (e != null ) { answers(); }
            } else if (m == messages[2]) {
                $('#video').attr("src", "https://www.youtube.com/embed/nPjynnu-FPE");
                $('#video').removeClass("hidden");
                localStorage.setItem("sensors/C", true);
                if (e != null ) { answers(); }
            } else if (m == messages[3]) {
                $('#video').attr("src", "https://www.youtube.com/embed/v4oWoTNu-cc");
                $('#video').removeClass("hidden");
                localStorage.setItem("sensors/D", true);
                if (e != null ) { answers(); }
            }
        }
        
        function answers() {
            var n = 0;
            if (localStorage.getItem("sensors/A")) {
                $('#A').text("REDIRECT TRAIN");
                $('#Arow').removeClass("hidden");
                $('#Arow').unbind("click");
                $('#Arow').click(function() {$('#code').val("REDIRECT TRAIN"); code(null);});
                ++n;
            }
            if (localStorage.getItem("sensors/B")) {
                $('#B').text("ROBOT OVERLORD");
                $('#Brow').removeClass("hidden");
                $('#Brow').unbind("click");
                $('#Brow').click(function() {$('#code').val("ROBOT OVERLORD"); code(null);});
                ++n;
            }
            if (localStorage.getItem("sensors/C")) {
                $('#C').text("JOURNAL MEMORY");
                $('#Crow').removeClass("hidden");
                $('#Crow').unbind("click");
                $('#Crow').click(function() {$('#code').val("JOURNAL MEMORY"); code(null);});
                ++n;
            }
            if (localStorage.getItem("sensors/D")) {
                $('#D').text("TEMPORAL SHIFT");
                $('#Drow').removeClass("hidden");
                $('#Drow').unbind("click");
                $('#Drow').click(function() {$('#code').val("TEMPORAL SHIFT"); code(null);});
                ++n;
            }
            $('#total').text(n);
            if (n == 4) {
                $('#journal').removeClass("hidden");
            }
        }
        
        $(document).ready(function() {
            if (!localStorage.getItem("sensors/access")) {
                window.location.replace("code.html");
            }
            updateLock();
            answers();
            $('.antenna').click(select);
            $('#frequency').on('input', function(e) {
               print(); 
            });
            print();
            $('#code').on("input", code);
        });

    </script>
    
    <style>
        .antenna { 
            border-style: solid;
            border-width: 1px;
            width: 75px;
            height: 75px;
        }
        .segment {
            border-style: solid;
            border-width: 1px;
            width: 50px;
            height: 50px;
        }
        .lock {
            position: relative;
            width: 75px;
            height: 75px;
            right: 78px;
            background-color: black;
            opacity: 0.7;
        }
        .selected {
            border-width: 2px;
            border-color: red;
        }
        #signal {
            margin: 20px;
        }
        .hidden {
            visibility: hidden;
        }
        .segment-row {
            margin: 5px;
        }
    </style>
  </head>
  <body>

    <nav class="navbar navbar-inverse">
       <ul class="nav navbar-nav">
          <li><a href="train.html">Home</a></li>
          <li class="active"><a href="sensors.html">Sensors</a></li>
          <li><a href="map.html">Map</a></li>
          <li><a href="status.html">Status</a></li>
       </ul>
    </nav>

    <div class="container">
        <div class="row">
            <div class="col-md-9 col-md-offset-3">
                <h2>Antennas</h2>
            </div>
        </div>
        <div class="row">
            <div class="col-md-3">
                <div class="form-group">
                  <label for="frequency">Frequency (kHz):</label>
                  <input type="text" class="form-control" id="frequency">
                </div>
            </div>
            <div class="col-md-3">
                <img src="antenna1.png" class="antenna" id="antenna1"/>
            </div>
            <div class="col-md-3">
                <img src="antenna2.png" class="antenna" id="antenna2"/>  
            </div>
            <div class="col-md-3">
                <img src="antenna3.png" class="antenna" id="antenna3"/>
                <img src="lock.png" class="lock"/>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12">
                <center>
                <canvas id="signal" width="600" height="50">
                    
                </canvas>
                </center>
            </div>
        </div>
        <div class="row">
            <div class="col-md-4">
                <div class="row">
                    <div class="form-group">
                      <label for="frequency">Signal Code:</label>
                      <input type="text" class="form-control" id="code">
                    </div>
                </div>
                <div class="row">
                    <span id="total">0</span>/4 Messages Received
                </div>
                <div id="journal" class="row hidden">
                    <pre>Received file: journal.txt
Sent to printer.</pre>
                </div>
                <div class="row segment-row hidden" id="Arow">
                    <img src="A.png" class="segment"/> = <span id="A"/>
                </div>
                <div class="row segment-row hidden" id="Brow">
                    <img src="B.png" class="segment"/> = <span id="B"/>
                </div>
                <div class="row segment-row hidden" id="Crow">
                    <img src="C.png" class="segment"/> = <span id="C"/>
                </div>
                <div class="row segment-row hidden" id="Drow">
                    <img src="D.png" class="segment"/> = <span id="D"/>
                </div>
            </div>
            <div class="col-md-8">
                <iframe class="hidden" id="video" width="600" height="400" frameborder="0"></iframe>
            </div>
        </div>
    </div>
    
</html>