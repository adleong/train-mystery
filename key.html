<!DOCTYPE html>
<!-- /hacker/key.html -->
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Trans-Eurasian Hyperexpress</title>

    <!-- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <style type="text/css">
    .ui {
      display: inline-block;
      vertical-align: middle;
      float: none;
      padding-top: 200px;
    }

    #password {
      width: 90px;
    }
    
    .container p {
      margin-top: 20px;
      margin-bottom: 20px;
    }
    </style>

    <!-- Latest compiled and minified JavaScript -->
    <script src="js/jquery-2.1.4.min.js"></script>
    <script src="js/bootstrap.min.js"></script>

    <script type="text/javascript">
      function keyBase() {
        ctx = $('#key')[0].getContext('2d');
        ctx.fillStyle = '#CFB53B';
        ctx.beginPath();
        ctx.arc(200, 500, 100, 0, Math.PI*2);
        ctx.fill();
        ctx.fillRect(175, 8, 50, 500);
      }

      function drawWords(words) {
        ctx = $('#key')[0].getContext('2d');
        ctx.font = '12px';
        ctx.fillStyle = "#000000";
        for (i = 0; i < words.length; ++i) {
          ctx.fillText(words[i], 325, 12+30*i);
        }
      }

      function keyTeeth(words, pattern) {
        ctx = $('#key')[0].getContext('2d');
        ctx.fillStyle = '#FFFFFF';
        ctx.fillRect(225, 8, 50, 400);
        ctx.fillStyle = '#CFB53B';
        matches = words.map(function(w) { return !!w.match(pattern); });
        matches.push(false);
        for (i = 0; i < words.length; ++i) {
          if (matches[i]) {
            if (matches[i+1]) {
              ctx.fillRect(225, 30*i+8, 50, 30);
            } else {
              ctx.beginPath();
              ctx.moveTo(225, 30*i+8);
              ctx.lineTo(275, 30*i+8);
              ctx.lineTo(225, 30*i+68);
              ctx.closePath();
              ctx.fill();
            }
          }
        }
        matches.pop();
        correct = words.map(function(w) { return !!w.match('..CK.*R$'); });
        if (matches.every(function(v,i) { return correct[i] === v; })) {
          alert("Password accepted");
          localStorage.setItem("map/access", true);
          window.location.replace("map.html");
        }
      }

      $(document).ready(function(){
        words = ['TRUCKER', 'ICKIER', 'LUCKYSTAR', 'HACKER', 'BLACKCAR', 'BACKERS', 'CRACKER', 'ACKERR', 'BREAKER', 'REUNHACK', 'DOCKR', 'UNHACK'];

        $('#password').on('input',function(e){
          keyTeeth(words, $('#password')[0].value.toUpperCase());

        });

        keyBase();
        drawWords(words);
        $('#password')[0].value = "^B.*R$";
        keyTeeth(words, "^B.*R$");
      });
    </script>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

  </head>
  <body>

    <nav class="navbar navbar-inverse">
       <ul class="nav navbar-nav">
          <li><a href="train.html">Home</a></li>
          <li><a href="sensors.html">Sensors</a></li>
          <li class="active"><a href="map.html">Map</a></li>
          <li><a href="status.html">Status</a></li>
       </ul>
    </nav>

    <div class="container">
    <div class="row">
      <div class="col-md-6">
        <canvas id="key" width="400" height="600">
        </canvas>
      </div>
      <div class="col-md-6 container">
        <h1>Password Required</h1>
        <p>Youâ€™ll need the password in order to get past this screen.</p>
        <form class="navbar-form">
          <div class="form-group">
            Password:
            <input type="text" class="form-control" id="password" maxlength="8">
          </div>

        </form>
      </div>
    </div>
  </div>

  </body>
</html>